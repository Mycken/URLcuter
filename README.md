Short URL
=========
Краткое описание
-----------------
REST-сервис сокращения ссылок на Java. Используемые фреймворки и библиотеки:

- Spring (Boot, Data, Test);
- Lombok;
- JUnit и Mockito;
- встраиваемая СУБД H2.

Сборка проекта:

```
$ cd shorturl
$ mvn package
```

Запуск проекта:
```
$ java -jar ./target/shorturl-1.0.jar
```

Ограничения
-----------
Максимальное количество возможных ссылок составляет ```Integer.MAX_VALUE``` из-за поля id класса `com.madvena.shorturl.model.Url`, а также реализации класса `com.madvena.shorturl.util.Base62.`

Описание алгоритма генерации коротких имен
---------------------------
Генерация короткого имени происходит переводом идентификатора записи, сгенерированного базой данных, в 62-ричную систему счисления.

Краткое описание классов
------------------------
В корневом пакете проекта `com.madvena.shorturl` находится класс Application, содержащий в себе точку входа в приложение.

В пакете `controller` содержится класс:

`UrlController` - контроллер, который принимает все команды сервиса:

- `/generate` - генерация короткой ссылки

- `/l/{link}` - переход по короткой ссылке (redirect)

- `/stats/l/{link}` - данные о количестве переходов и рейтинге короткой ссылки

- `/stats` - список ссылок, ранжированный по рейтингу

`GlobalExceptionHandler` - класс по обработке ошибок и формированию ответов сервера

В пакете `exception` содержаться классы:


- `UrlServiceException` - базовый класс исключений, генерируемых классом UrlService;

- `LinkNotFoundException` - исключение, генерируемое классом UrlService, если ссылка, переданная как параметр, не была найдена в хранилище;

- `WrongLinkException` - исключение, генерируемое классом UrlService, если ссылка, переданная как параметр, имела неверный формат.

- `Base62Exception` - исключение, генерируемое классом Base62, в случае передачи некорректных параметров для кодирования/декодирования короткой ссылки.

В пакете `model` содержатся:

- `Url` - класс-модель данных, хранящихся в UrlRepository;

- `LinkResponseDto` - класс, описывающий объект отправляемый сервисом в качестве ответа на запрос о получение короткой ссылки

- `UrlRequestDto` - класс, описывающий объект получаемый сервисом в качестве запроса на изменение заданного url

- `StatisticDto` - класс, описывающий объект url в представлении link-original-rank-count для передачи по запросам /stats/**

- `ErrorResponse` - класс, описывающий ответ ошибки сервера

В пакете `repository` содержится интерфейс хранилища данных `UrlRepository`, логика которого имплементируется автоматически с помощью библиотеки `Spring Data JPA`.

В пакете `service` содержатся классы:

`UrlService` и `UrlServiceImpl` - сервис, реализующий основную логику данной программы;

В пакете `util` содержится статический класс `Base62`, осуществляющий перевод чисел типа `Integer` в строку, содержащую то же число в 62-ричной системе счисления, и обратно.


Описание внешнего программного интерфейса
--------------
### Генерация коротких ссылок
Для создания новой короткой ссылки необходимо послать POST-запрос на адрес /generate. В теле запроса должен находиться объект в формате JSON со строковым параметром original. Этот параметр должен удовлетворять следующим требованиям:

- не пустая строка;
- максимальный допустимый размер строки - 2000 символов;
- строка должна соответствовать формату URL с обязательным указанием протокола.

В ответе возвращается объект с единственным полем link, в котором указывается сгенерированная короткая ссылка.

Пример запроса:

```
POST /generate HTTP/1.1
Host: localhost:8080
Content-Type: application/json

{
	"original": "https://some-server.com/some/url?some_param=1"
}
```
Пример ответа:

```
HTTP/1.1 200 OK
Content-Type: application/json

{
    "link": "/l/1va"
}
```

В случаях если поле `original` будет иметь неверный формат, клиенту возвращается код `400 Bad Request` и короткая ссылка не будет создана.

### Переход по короткой ссылке
Для перехода по короткой ссылке необходимо осуществить GET-запрос по ссылке, возвращенной на шаге генерации.

```http
GET /l/1va HTTP/1.1
```
В случаях если короткое имя будет иметь неверный формат, клиенту возвращается код `400 Bad Request`. В случаях если короткое имя не существует в базе данных, клиенту возвращается код 404 Not Found.

### Статистика

#### Статистика по конкретным ссылкам
Ресурс `/stats/{some-short-name}` обрабатывает GET-запрос и возвращает статистику переходов по конкретной ссылке. Параметры пути запроса:

- `some-short-name` - идентификатор ссылки.
В ответе сервиса должен содержаться JSON-объект со следующими полями:

- `link` - сгенерированная короткая ссылка;
- `original` - оригинальная ссылка;
- `rank` - место ссылки в топе запросов;
- `count` - число запросов по короткой ссылке.

Пример запроса:
```
GET /stats/some-short-name HTTP/1.1
```
Пример ответа:

```http
HTTP/1.1 200 OK
Content-Type: application/json

{
    "link": "/l/some-short-name",
    "original": "http://some-server.com/some/url",
    "rank": 1,
    "count": 100500
}
```

В случаях если короткое имя будет иметь неверный формат, клиенту возвращается код `400 Bad Request`. В случаях если короткое имя не существует в базе данных, клиенту возвращается код 404 Not Found.

#### Рейтинг ссылок
Ресурс `/stats` обрабатывает GET-запрос и возвращает статистику запросов с сортировкой по частоте запросов по убыванию и возможностью постраничного отображения. Параметры строки запроса:

- `page` - номер страницы (значение по умолчанию: 0, ограничения: только положительные числа или 0);
- `count` - число записей, отображаемых на странице (минимальное значение: 1, максимальное возможное значение: 100, значение по умолчанию: 100)

В ответе сервиса содержится массив из JSON-объектов, описанных в разделе Статистика по конкретным ссылкам.

Пример запроса:
```
GET /stats?page=1&count=2 HTTP/1.1
```
Пример ответа:
```
HTTP/1.1 200 OK
Content-Type: application/json

[
    {
        "link": "/l/some-short-name",
        "original": "http://some-server.com/some/url",
        "rank": 1,
        "count": 100500
    },
    {
        "link": "/l/some-another-short-name",
        "original": "http://another-server.com/some/url",
        "rank": 2,
        "count": 40000
    }
]
```
В случаях нарушения ограничений на параметры page и/или count будет возвращен код `400 Bad Request`.
